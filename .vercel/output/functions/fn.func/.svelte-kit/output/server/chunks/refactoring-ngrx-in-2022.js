import { c as create_ssr_component } from "./index2.js";
const metadata = {
  "title": "Refactoring NgRx in 2022",
  "date": "2022-11-11",
  "description": "New APIs are availabe to make your NgRx implementation more readable with far less code. Let's refactor an existing feature store using these new APIs to see the difference!",
  "published": true,
  "tags": ["angular", "ngrx"]
};
const Refactoring_ngrx_in_2022 = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  return `<h2 id="${"refactoring-ngrx-in-2022"}">Refactoring NgRx in 2022</h2><a href="${"#refactoring-ngrx-in-2022"}"><span class="${"icon icon-link"}"></span></a>
<p>NgRx version 14 introduced the <a href="${"https://ngrx.io/api/store/createActionGroup"}" rel="${"nofollow"}">createActionGroup</a> API and a lot of people are excited about it. With this addition, NgRx actions are much easier to write and the format is far more readable. At a glance, you can see what actions affect a slice of state and their event sources.</p>
<p>While I’ve seen a ton of hype around <code>createActionGroup</code>, I haven’t seen much about the <a href="${"https://ngrx.io/api/store/createFeature"}" rel="${"nofollow"}">createFeature</a> API. First introduced in version 12, the <code>createFeature</code>API simplifies the creation and registration of your reducer, but it also generates selectors for your feature and every property on the state object. When these two APIs are used together, it makes for a cleaner, far more concise NgRx implementation.</p>
<h3 id="${"why-refactor"}">Why refactor?</h3><a href="${"#why-refactor"}"><span class="${"icon icon-link"}"></span></a>
<p>You might ask why you should refactor working NgRx code. It’s a fair question and the short answer is that you don’t have to, of course. However, these new APIs improve readability and dramatically reduce the amount of code you have to write. In other words, your NgRx implementation becomes easier to understand and easier to maintain. I’ve refactored several feature stores now and the consensus among “codeowners” is that it was well worth the effort.</p>
<p>To see this in action, let’s refactor a relatively simple feature store implemenation to take advantage of these new APIs.</p>
<pre class="${"language-typescript"}"><!-- HTML_TAG_START -->${`<code class="language-typescript"><span class="token comment">// ACTIONS</span>
<span class="token keyword">const</span> loadBooks <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">"[Books Page] fetch books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loadBooksSuccess <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Books Page] fetch books success"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> books<span class="token operator">:</span> Book<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loadBooksError <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Books Page] fetch books failure"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> loadBookById <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">"[Books Details Panel] fetch book by id"</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loadBookByIdSuccess <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Book Details Panel] fetch book by id success"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> books<span class="token operator">:</span> Book <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loadBookByIdError <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Book Details Panel] fetch book by id failure"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> editBookDetails <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Books Details Panel] edit book details"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> book<span class="token operator">:</span> Book <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> editBookDetailsSuccess <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Book Details Panel] edit book details success"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> update<span class="token operator">:</span> Update<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> editBookDetailsError <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">"[Book Details Panel] edit book details error"</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> fromBooksActions <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  loadBooks<span class="token punctuation">,</span>
  loadBooksSuccess<span class="token punctuation">,</span>
  loadBooksError<span class="token punctuation">,</span>
  editBookDetails<span class="token punctuation">,</span>
  editBookDetailsSuccess<span class="token punctuation">,</span>
  editBookDetailsError<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// Reducers</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">BOOKS_FEATURE_KEY</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">books</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Book<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState<span class="token operator">:</span> BooksState <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  selectedBookId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> booksReducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooks<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooksSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> books <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">setMany</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooksError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooksById<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooksByIdSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> book <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">upsertOne</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadBooksByIdError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>editBookDetails<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>editBookDetailsSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> update <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>editBookDetailsError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Selectors</span>
<span class="token keyword">const</span> booksFeature <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>BooksState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token constant">BOOKS_FEATURE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> selectLoading <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  booksFeature<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>state<span class="token operator">:</span> BooksState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>loading
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> selectError <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  booksFeature<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>state<span class="token operator">:</span> BooksState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>error
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> selectBooks <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  booksFeature<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>state<span class="token operator">:</span> BooksState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>books
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> selectSelectedBookId <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  booksFeature<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>state<span class="token operator">:</span> BooksState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>selectedBookId
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> selectAll <span class="token punctuation">&#125;</span> <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> fromBooksSelectors <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  selectBooks<span class="token operator">:</span> selectAll<span class="token punctuation">,</span>
  selectLoading<span class="token punctuation">,</span>
  selectError<span class="token punctuation">,</span>
  selectBooks<span class="token punctuation">,</span>
  selectSelectedBookId
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code>`}<!-- HTML_TAG_END --></pre>
<p>While the helper functions <code>createAction</code>, <code>createReducer</code>, and <code>createSelector</code> helped a lot with reducing the verbosity of NgRx, it was clear that there was still a fair amount of work involved with setting it up.</p>
<p>Now let’s take a look at what that looks like using the new APIs:</p>
<pre class="${"language-typescript"}"><!-- HTML_TAG_START -->${`<code class="language-typescript"><span class="token comment">// ACTIONS</span>
<span class="token keyword">const</span> booksPageActions <span class="token operator">=</span> <span class="token function">createActionGroup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  source<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Books Page</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'load books'</span><span class="token operator">:</span> <span class="token function">emptyProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'load books success'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> books<span class="token operator">:</span> Book<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'load books error'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bookDetailsPanelActions <span class="token operator">=</span> <span class="token function">createActionGroup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  source<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Book Details Panel</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'load book by id'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'load book by id success'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> book<span class="token operator">:</span> Book <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'load book by id error'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'edit book details'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> book<span class="token operator">:</span> Book <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'edit book details success'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> update<span class="token operator">:</span> Update<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">'edit book details error'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> fromBooksActions <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>booksPageActions<span class="token punctuation">,</span> <span class="token operator">...</span>bookDetailsPanelActions <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// Reducers</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Book<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState<span class="token operator">:</span> BooksState <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  selectedBookId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> booksFeature <span class="token operator">=</span> <span class="token function">createFeature</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">'books'</span><span class="token punctuation">,</span>
  reducer<span class="token operator">:</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
    initialState<span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooks<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooksSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> books <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">setMany</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooksError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooksById<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooksByIdSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> book <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">upsertOne</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>loadBooksByIdError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>editBookDetails<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>editBookDetailsSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> update <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> adapter<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span>editBookDetailsError<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> errorMessage <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> selectAll <span class="token punctuation">&#125;</span> <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> selectIsLoading<span class="token punctuation">,</span> selectError<span class="token punctuation">,</span> selectSelectedBookId <span class="token punctuation">&#125;</span> <span class="token operator">=</span> booksFeature<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> fromBooksSelectors <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  selectBooks<span class="token operator">:</span> selectAll<span class="token punctuation">,</span>
  selectIsLoading<span class="token punctuation">,</span>
  selectError<span class="token punctuation">,</span>
  selectSelectedBookId
<span class="token punctuation">&#125;</span></code>`}<!-- HTML_TAG_END --></pre>
<p>The original implementation in the first snippet was 100 lines of code. The refactored implementation in the second snippet is only 62 lines of code, which is a 38% decrease in verbosity. I’m seeing similar (and in some cases even larger) differences in production code as well.</p>
<p><strong>Note: I realize that I could get access to the selectors in my feature components through the exported <code>booksFeature</code> object, but that would provide easy access to the reducer from the component and I don’t want to do that. So I’m re-exporting the selectors wrapped in an object. </strong></p>
<h3 id="${"conclusion"}">Conclusion</h3><a href="${"#conclusion"}"><span class="${"icon icon-link"}"></span></a>
<p>In my opinion, <code>createActionGroup</code> improves readability for action creation. With this in place, it’s much easier to see quickly what actions are handled by a slice of state and what their event sources are.</p>
<p>For a more complete, deeper explanation of these new APIs and how to register them with the <a href="${"https://angular.io/guide/standalone-components"}" rel="${"nofollow"}">Angular Standalone Components API</a>, take a look at <a href="${"https://timdeschryver.dev/blog/you-should-take-advantage-of-the-improved-ngrx-apis"}" rel="${"nofollow"}">You Should Take Advantage of the Improved NgRx APIs</a> from NgRx team member Tim Deschryver.</p>`;
});
export {
  Refactoring_ngrx_in_2022 as default,
  metadata
};
